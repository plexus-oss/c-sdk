name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  host-tests:
    name: Host Tests (ASan + UBSan)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build tests
        run: |
          cmake -B build-test tests/
          cmake --build build-test/

      - name: Run tests
        run: ctest --test-dir build-test --output-on-failure

  host-tests-minimal:
    name: Host Tests (Minimal Config)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build tests (minimal config ~1.5KB)
        run: |
          cmake -B build-test-min tests/ -DPLEXUS_MINIMAL_CONFIG=ON
          cmake --build build-test-min/

      - name: Run tests (minimal)
        run: ctest --test-dir build-test-min --output-on-failure